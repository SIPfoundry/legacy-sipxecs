<?xml version="1.0" encoding="UTF-8"?>

<mappings xmlns="http://www.sipfoundry.org/sipX/schema/xml/urlmap-00-00">
  <hostMatch>
    <hostPattern>example.org</hostPattern>
    <hostPattern>sipx.example.org</hostPattern>
    <hostPattern>sipx</hostPattern>
    <hostPattern>192.168.1.1</hostPattern>
    <userMatch>
      <!--Music on Hold-->
      <description>Forward music-on-hold calls to IVR</description>
      <callTag>MOH</callTag>
      <userPattern>~~mh~u.</userPattern>
      <permissionMatch>
        <transform>
          <user>IVR</user>
          <host>192.168.1.5:9905</host>
          <urlparams>action=moh</urlparams>
          <urlparams>moh=u{vdigits}</urlparams>
        </transform>
      </permissionMatch>
    </userMatch>
    <userMatch>
      <!--RLS-->
      <description>Forward resource list subscriptions to RLS</description>
      <callTag>RL</callTag>
      <userPattern>~~rl~.</userPattern>
      <permissionMatch>
        <transform>
          <headerparams>Route=&lt;sip:192.168.1.5:9906;transport=tcp&gt;</headerparams>
        </transform>
      </permissionMatch>
    </userMatch>
    <userMatch>
      <callTag>AAM</callTag>
      <userPattern>*87</userPattern>
      <userPattern>*88</userPattern>
      <userPattern>123456</userPattern>
      <permissionMatch>
        <transform>
          <url>&lt;sip:IVR@192.168.1.1:102;dialed={digits};action=aamgmt&gt;</url>
        </transform>
      </permissionMatch>
    </userMatch>
    <userMatch>
      <!--Operator-->
      <callTag>AA</callTag>
      <userPattern>100</userPattern>
      <userPattern>operator</userPattern>
      <userPattern>0</userPattern>
      <permissionMatch>
        <transform>
          <url>&lt;sip:IVR@192.168.1.1:102;action=autoattendant;schedule_id=operator&gt;</url>
        </transform>
      </permissionMatch>
    </userMatch>
    <userMatch>
      <callTag>VM</callTag>
      <userPattern>101</userPattern>
      <userPattern>+123456789</userPattern>
      <permissionMatch>
        <transform>
          <url>&lt;sip:IVR@192.168.1.1:102;action=retrieve&gt;</url>
        </transform>
      </permissionMatch>
    </userMatch>
    <userMatch>
      <callTag>VM</callTag>
      <userPattern>102</userPattern>
      <permissionMatch>
        <transform>
          <url>&lt;sip:102@exchange.example.com;transport=tcp&gt;</url>
        </transform>
      </permissionMatch>
    </userMatch>
    <userMatch>
      <callTag>VM</callTag>
      <userPattern>2xxx</userPattern>
      <permissionMatch>
        <transform>
          <url>&lt;sip:IVR@192.168.1.1:102;mailbox={vdigits};action=deposit&gt;</url>
        </transform>
      </permissionMatch>
    </userMatch>
    <userMatch>
      <callTag>VM</callTag>
      <userPattern>2xxx</userPattern>
      <permissionMatch>
        <transform>
          <url>&lt;sip:102@exchange.example.com;transport=tcp?Diversion=%3Csip:{vdigits}%40{host}%3E%3Breason%3Dno-answer%3Bscreen%3Dno%3Bprivacy%3Doff&gt;</url>
        </transform>
      </permissionMatch>
    </userMatch>
    <userMatch>
      <callTag>VM</callTag>
      <userPattern>~~vm~.</userPattern>
      <permissionMatch>
        <permission>FreeswitchVoicemailServer</permission>
        <transform>
          <url>&lt;sip:IVR@192.168.1.1:102;mailbox={vdigits};action=deposit&gt;;q=0.1</url>
        </transform>
      </permissionMatch>
    </userMatch>
    <userMatch>
      <callTag>VM</callTag>
      <userPattern>~~vm~.</userPattern>
      <permissionMatch>
        <transform>
          <url>&lt;sip:102@exchange.example.com;transport=tcp?Diversion=%3Csip:{vdigits}%40{host}%3E%3Breason%3Dno-answer%3Bscreen%3Dno%3Bprivacy%3Doff&gt;;q=0.1</url>
        </transform>
      </permissionMatch>
    </userMatch>
    <userMatch>
      <description>Voicemail redirect dialing rule</description>
      <callTag>VMR</callTag>
      <userPattern>.</userPattern>
      <permissionMatch>
        <permission>Voicemail</permission>
        <transform>
          <user>~~vm~{user}</user>
          <fieldparams>q=0.1</fieldparams>
        </transform>
      </permissionMatch>
    </userMatch>
  </hostMatch>
</mappings>
