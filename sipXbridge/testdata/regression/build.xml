<?xml version="1.0"?>
<project name="siptester" default="test" basedir=".">
<description>
      Build file
</description>
        <property file="build.properties" />
        <path id="base.path">
	   <pathelement location="${sipxcommons}" />
	   <pathelement location="${log4j}" />
	   <pathelement location="${jainsip}" />
	   <pathelement location="${commons-digester}" />
	   <pathelement location="${commons-collections}" />
	   <pathelement location="${commons-beanutils}" />
 	   <pathelement location="${commons-logging-api}" />
	   <pathelement location="${commons-logging}" />
	   <pathelement location="${dnsjava}" />
	   <pathelement location="${regression-tester-jar}" />
	</path>
	<property name="sipxproc" value="${prefix.dir}/bin/sipxproc" />
	<property name="address" value="192.168.5.75" />

	<target name="help" description="print help text. ">
	   <echo> 
	   **************************************** 
	    syntax   :
	    ant -Dtestname=test-name -Daddress=tester-ip-address test 
	    example  :
	    ant -Dtestname=itsp-local-blind-local -Daddress=192.168.5.240 test
	    ****************************************
	    </echo>
	</target>

	<presetdef name="brestart">
        	<exec  executable="sudo">
          		<arg value= "${sipxproc}" />
          		<arg value= "--restart" />
          		<arg value= "SipXbridge" />
        	</exec>
	</presetdef>
        <target name="test" description="Hairpinned call forwarding with re-invite" >
                <exec executable="./convert.sh">
                      <arg value="${address}" /> 
                      <arg value="${testname}" />
                </exec>
        	<delete file="sipxtester.log" failonerror="false" />
    	 	<delete file="/usr/local/sipx/etc/sipxpbx/sipxbridge.xml" failonerror="false" />
    	 	<copy file="./${testname}/sipxbridge.xml" todir="/usr/local/sipx/etc/sipxpbx/" />
    	 	<brestart />
    	 	<sleep seconds="10" />
     		<java fork="yes" classname="org.sipfoundry.siptester.SipTester">
           		<classpath>
               			<pathelement location="${classes}" />
           		</classpath>
           		<classpath refid="base.path" />
          		<jvmarg value="-Dtest.prefix=./${testname}"/>
    		</java>
	</target>
        <target name="itsp-local-blind-local" description="blind transfer of incoming ITSP call to a local extension" >
       	   <delete file="sipxtester.log" />
     	    <delete file="/usr/local/sipx/etc/sipxpbx/sipxbridge.xml" />
    	    <copy file="./itsp-local-blind-local/sipxbridge.xml" todir="/usr/local/sipx/etc/sipxpbx/" />
    	    <brestart />
    	    <sleep seconds="10" />
            <java fork="yes" classname="org.sipfoundry.siptester.SipTester">
               <classpath>
                  <pathelement location="${classes}" />
               </classpath>
               <classpath refid="base.path" />
               <jvmarg value="-Dtest.prefix=./itsp-local-blind-local"/>
             </java>
        </target>
        <target name="itsp-local-attended-itsp" description="attend transfer of incoming ITSP call to a ITSP extension" >
       	   <delete file="sipxtester.log" />
     	    <delete file="/usr/local/sipx/etc/sipxpbx/sipxbridge.xml" />
    	    <copy file="./itsp-local-attended-itsp/sipxbridge.xml" todir="/usr/local/sipx/etc/sipxpbx/" />
    	    <brestart />
    	    <sleep seconds="10" />
            <java fork="yes" classname="org.sipfoundry.siptester.SipTester">
               <classpath>
                  <pathelement location="${classes}" />
               </classpath>
               <classpath refid="base.path" />
               <jvmarg value="-Dtest.prefix=./itsp-local-attended-itsp"/>
             </java>
        </target>
        <target name="local-itsp-attended-itsp" description="attend transfer of incoming ITSP call to a ITSP extension" >
       	   <delete file="sipxtester.log" />
     	    <delete file="/usr/local/sipx/etc/sipxpbx/sipxbridge.xml" />
    	    <copy file="./local-itsp-attended-itsp/sipxbridge.xml" todir="/usr/local/sipx/etc/sipxpbx/" />
            <java fork="yes" classname="org.sipfoundry.siptester.SipTester">
               <classpath>
                  <pathelement location="${classes}" />
               </classpath>
               <classpath refid="base.path" />
               <jvmarg value="-Dtest.prefix=./local-itsp-attended-itsp"/>
             </java>
        </target>
</project>
