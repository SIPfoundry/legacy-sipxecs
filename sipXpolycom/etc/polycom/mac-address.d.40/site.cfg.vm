<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!--   Generated by sipXecs: http://www.sipfoundry.org/

   Instructions for integrating new configuration file content into sipXconfig:
     http://wiki.sipfoundry.org/display/xecsdev/Adding+Polycom+SoundPoint+IP+New+Configuration+File+Content+into+sipXconfig
-->
#macro (computeCodecSettings $setting $prefix)

   #set ($selected_codecs = $setting.getTypedValue())
   #set ($codec_options = $setting.getType().getEnums().keySet())

   ## Loop through each supported codec.
   #foreach ($codec_option in $codec_options)

      ## Determine the selected preference value of this codec.  (Blank if not selected.)
      #if (${selected_codecs.contains(${codec_option})})
         #set ($codec_value = $math.add($selected_codecs.indexOf($codec_option), "1"))
      #else
         #set ($codec_value = "")
      #end

      ## Generate the codec preference value.
      ${prefix}.${codec_option}="${codec_value}"
   #end
#end
<polycomConfig xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="polycomConfig.xsd">
## SIMILIAR DIALPLAN SECTION EXISTS IN phone.cfg.vm
## to control dialplans for each line
  <dialplan
#set ($group = $cfg.EndpointSettings.getSetting('dialplan'))
#foreach ($setting in $cfg.getSettings($group))
    dialplan.${setting.ProfileName}="$!{setting.Value}"
#end
  >
     <digitmap
#set ($group = $cfg.EndpointSettings.getSetting('dialplan').getSetting('digitmap'))
#foreach ($setting in $cfg.getSettings($group))
      dialplan.${setting.ProfileName}="$!{setting.Value}"
#end
    />
    <routing>
      <server
#set ($group = $cfg.EndpointSettings.getSetting('dialplan').getSetting('digitmap').getSetting('routing.1'))
        dialplan.routing.server.1.address="$!{group.getSetting('address').Value}"
        dialplan.routing.server.1.port="$!{group.getSetting('port').Value}"
      />
      <emergency
#set ($group = $cfg.EndpointSettings.getSetting('dialplan').getSetting('digitmap').getSetting('routing.1'))
#set ($index = 1)
#foreach ($emergencyVal in $cfg.EmergencySetting)
        dialplan.routing.emergency.${index}.value="$!{emergencyVal}"
#set ($index = $index+1)
#end
      />
    </routing>
  </dialplan>
  <lcl>
#set ($setting = $cfg.EndpointSettings.getSetting('localization/language'))
      <lcl.ml lcl.ml.lang="$!{setting.Value}">
      </lcl.ml>
    <lcl.datetime>
      <lcl.datetime.time
#set ($group = $cfg.EndpointSettings.getSetting('lcl').getSetting('time'))
#foreach ($setting in $cfg.getSettings($group))
        lcl.datetime.time.${setting.ProfileName}="$!{setting.Value}"
#end
      />
      <lcl.datetime.date
#set ($group = $cfg.EndpointSettings.getSetting('lcl').getSetting('datetime'))
#foreach ($setting in $cfg.getSettings($group))
        lcl.datetime.${setting.ProfileName}="$!{setting.Value}"
#end
      />
    </lcl.datetime>
  </lcl>
  <up
#set ($group = $cfg.EndpointSettings.getSetting('up'))
#foreach ($setting in $cfg.getSettings($group))
#if ($setting.ProfileName != "analogHeadsetOption")
    up.${setting.ProfileName}="$!{setting.Value}"
#end
#end
  >
#if ($phone.model.isSupported("video"))
    <up.pictureFrame
#set ($group = $cfg.EndpointSettings.getSetting('up').getSetting('pictureFrame'))
#foreach ($setting in $cfg.getSettings($group))
      up.pictureFrame.${setting.ProfileName}="$!{setting.Value}"
#end
    />
#end
#if ($phone.model.isSupported("video"))
    <up.screenSaver
#set ($group = $cfg.EndpointSettings.getSetting('up').getSetting('screenSaver'))
#foreach ($setting in $cfg.getSettings($group))
      up.screenSaver.${setting.ProfileName}="$!{setting.Value}"
#end
    />
#end
  </up>
  <se
#set ($group = $cfg.EndpointSettings.getSetting('se'))
#foreach ($setting in $cfg.getSettings($group))
    se.${setting.ProfileName}="$!{setting.Value}"
#end
  />

  <voice
#set ($group = $cfg.EndpointSettings.getSetting('voice'))
#foreach ($setting in $cfg.getSettings($group))
    voice.${setting.ProfileName}="$!{setting.Value}"
#end
  >
      <voice.codecPref
#set ($group = $cfg.EndpointSettings.getSetting('voice').getSetting('codecPref'))
## This is a loop, but there will only ever be one codec group per Polycom model.
#foreach ($setting in $cfg.getSettings($group))
      #set ($prefix = "voice.codecPref")
   #computeCodecSettings($setting $prefix)
#end
      />
    <voice.volume
#set ($group = $cfg.EndpointSettings.getSetting('voice').getSetting('volume'))
#foreach ($setting in $cfg.getSettings($group))
      voice.volume.${setting.ProfileName}="$!{setting.Value}"
#end
    />
      <voice.audioProfile
#set($voice_audioProfile_G7221_24kbps_payloadType = "127")
      voice.audioProfile.G7221.24kbps.payloadType="$!{voice_audioProfile_G7221_24kbps_payloadType}"
#set ($group = $cfg.EndpointSettings.getSetting('voice').getSetting('audioProfile'))
#foreach ($subgroup in $group.Values)
#set ($parentProfileName = $subgroup.ProfileName)
#foreach ($setting in $subgroup.Values)
        voice.audioProfile.${parentProfileName}.${setting.ProfileName}="$!{setting.Value}"
#end
#end
      />
    </codecs>
    <voice.vad
#set ($group = $cfg.EndpointSettings.getSetting('voice').getSetting('vad'))
#foreach ($setting in $cfg.getSettings($group))
      voice.${setting.ProfileName}="$!{setting.Value}"
#end
    />
  </voice>
  <qos>
    <qos.ethernet>
#set ($group = $cfg.EndpointSettings.getSetting('qos').getSetting('ethernet'))
#set ($setting = $group.getSetting('rtp.user_priority'))
      <qos.ethernet.rtp qos.ethernet.${setting.ProfileName}="$!{setting.Value}" />
#set ($setting = $group.getSetting('callControl.user_priority'))
      <qos.ethernet.callControl qos.ethernet.${setting.ProfileName}="$!{setting.Value}" />
#set ($setting = $group.getSetting('other.user_priority'))
      <qos.ethernet.other qos.ethernet.${setting.ProfileName}="$!{setting.Value}" />
#if ($phone.model.isSupported("video"))
#set ($setting = $group.getSetting('rtp.video.user_priority'))
      <qos.ethernet.rtp.video qos.ethernet.${setting.ProfileName}="$!{setting.Value}" />
#end
    </qos.ethernet>
    <qos.ip>
      <qos.ip.rtp
#set ($group = $cfg.EndpointSettings.getSetting('qos').getSetting('ip.rtp'))
#foreach ($setting in $cfg.getSettings($group))
        qos.ip.rtp.${setting.ProfileName}="$!{setting.Value}"
#end
      >
#if ($phone.model.isSupported("video"))
        <qos.ip.rtp.video
#set ($group = $cfg.EndpointSettings.getSetting('qos').getSetting('ip.rtp').getSetting('video'))
#foreach ($setting in $cfg.getSettings($group))
        qos.ip.rtp.video.${setting.ProfileName}="$!{setting.Value}"
#end
        />
#end
      </qos.ip.rtp>
      <qos.ip.rtp.callControl
#set ($group = $cfg.EndpointSettings.getSetting('qos').getSetting('ip.callControl'))
#foreach ($setting in $cfg.getSettings($group))
        qos.ip.callControl.${setting.ProfileName}="$!{setting.Value}"
#end
      />
    </qos.ip>
  </qos>

  <tcpIpApp>
    <tcpIpApp.sntp
#set ($group = $cfg.EndpointSettings.getSetting('tcpIpApp.sntp'))
#foreach ($setting in $cfg.getSettings($group))
      tcpIpApp.sntp.${setting.ProfileName}="$!{setting.Value}"
#end
    />
    <tcpIpApp.port>
      <tcpIpApp.port.rtp
#set ($group = $cfg.EndpointSettings.getSetting('tcpIpApp.port.rtp'))
#foreach ($setting in $cfg.getSettings($group))
        tcpIpApp.port.rtp.${setting.ProfileName}="$!{setting.Value}"
#end
      />
    </tcpIpApp.port>
    <tcpIpApp.keepalive
#set ($group = $cfg.EndpointSettings.getSetting('tcpIpApp.keepalive.tcp'))
#foreach ($setting in $cfg.getSettings($group))
      tcpIpApp.keepalive.tcp.${setting.ProfileName}="$!{setting.Value}"
#end
    />
  </tcpIpApp>

  <httpd
#set ($group = $cfg.EndpointSettings.getSetting('httpd'))
#foreach ($setting in $cfg.getSettings($group))
    httpd.${setting.ProfileName}="$!{setting.Value}"
#end
  >
    <httpd.cfg
#set ($group = $cfg.EndpointSettings.getSetting('httpd').getSetting('cfg'))
#foreach ($setting in $cfg.getSettings($group))
      httpd.cfg.${setting.ProfileName}="$!{setting.Value}"
#end
    />
  </httpd>
  <key
#set ($group = $cfg.EndpointSettings.getSetting('key'))
#foreach ($setting in $cfg.getSettings($group))
    key.${setting.ProfileName}="$!{setting.Value}"
#end
  />
  <log>
    <log.level>
      <log.level.change
#set ($group = $cfg.EndpointSettings.getSetting('log').getSetting('level.change'))
#foreach($levelSetting in $group.Values)
        log.level.change.${levelSetting.Name}="${levelSetting.Value}"
#end
      />
    </log.level>
    <log.render
#set ($group = $cfg.EndpointSettings.getSetting('log').getSetting('render'))
#foreach ($setting in $cfg.getSettings($group))
      log.render.${setting.ProfileName}="$!{setting.Value}"
#end
    />
  </log>

  <sec
#set ($group = $cfg.EndpointSettings.getSetting('sec'))
#foreach ($setting in $cfg.getSettings($group))
    sec.${setting.ProfileName}="$!{setting.Value}"
#end
  >
    <sec.pwd>
      <sec.pwd.length
#set ($group = $cfg.EndpointSettings.getSetting('sec').getSetting('pwd.length'))
#foreach ($setting in $cfg.getSettings($group))
        sec.pwd.length.${setting.ProfileName}="$!{setting.Value}"
#end
      />
    </sec.pwd>

#if ($phone.model.isSupported("video"))
  <powerSaving
#set ($group = $cfg.EndpointSettings.getSetting('powerSaving'))
#foreach ($setting in $cfg.getSettings($group))
      powerSaving.${setting.ProfileName}="$!{setting.Value}"
#end
  >
     <powerSaving.officeHours
#set ($group = $cfg.EndpointSettings.getSetting('powerSaving').getSetting('officeHours'))
#foreach ($setting in $cfg.getSettings($group))
      powerSaving.officeHours.${setting.ProfileName}="$!{setting.Value}"
#end
     />
     <powerSaving.idleTimeout
#set ($group = $cfg.EndpointSettings.getSetting('powerSaving').getSetting('idleTimeout'))
#foreach ($setting in $cfg.getSettings($group))
      powerSaving.idleTimeout.${setting.ProfileName}="$!{setting.Value}"
#end
     />
    <powerSaving.userDetectionSensitivity
#set ($group = $cfg.EndpointSettings.getSetting('powerSaving').getSetting('userDetectionSensitivity'))
#foreach ($setting in $cfg.getSettings($group))
      powerSaving.userDetectionSensitivity.${setting.ProfileName}="$!{setting.Value}"
#end
     />
  </powerSaving>
#end

  <divert
#foreach ($line in $lines)
#set ($i = $velocityCount)
#set ($group = $line.getSetting('divert'))
#foreach ($setting in $cfg.getSettings($group))
    divert.${i}.${setting.ProfileName}="$!{setting.Value}"
#end
#end
  >
    <fwd
#foreach ($line in $lines)
#set ($i = $velocityCount)
#set ($group = $line.getSetting('divert').getSetting('fwd'))
#foreach ($setting in $cfg.getSettings($group))
      divert.fwd.${i}.${setting.ProfileName}="$!{setting.Value}"
#end
#end
    />
    <busy
#foreach ($line in $lines)
#set ($i = $velocityCount)
#set ($group = $line.getSetting('divert').getSetting('busy'))
#foreach ($setting in $cfg.getSettings($group))
      divert.busy.${i}.${setting.ProfileName}="$!{setting.Value}"
#end
#end
    />
    <noanswer
#foreach ($line in $lines)
#set ($i = $velocityCount)
#set ($group = $line.getSetting('divert').getSetting('noanswer'))
#foreach ($setting in $cfg.getSettings($group))
      divert.noanswer.${i}.${setting.ProfileName}="$!{setting.Value}"
#end
#end
    />
    <dnd
#foreach ($line in $lines)
#set ($i = $velocityCount)
#set ($group = $line.getSetting('divert').getSetting('dnd'))
#foreach ($setting in $cfg.getSettings($group))
      divert.dnd.${i}.${setting.ProfileName}="$!{setting.Value}"
#end
#end
    />
  </divert>
  
##LINES DIALPLAN
  <dialplan
#foreach ($line in $lines)
#set ($i = $velocityCount)
#set ($group = $line.getSetting('line-dialplan'))
#foreach ($setting in $cfg.getSettings($group))
    dialplan.${i}.${setting.ProfileName}="$!{setting.Value}"
#end
    dialplan.${i}.applyToUserSend="1"
    dialplan.${i}.applyToUserDial="1"
    dialplan.${i}.applyToCallListDial="0"
    dialplan.${i}.applyToDirectoryDial="0"
#end
  >
    <digitmap
#foreach ($line in $lines)
#set ($i = $velocityCount)
#set ($group = $line.getSetting('line-dialplan').getSetting('digitmap'))
#foreach ($setting in $cfg.getSettings($group))
      dialplan.${i}.${setting.ProfileName}="$!{setting.Value}"
#end
#end
    />
    <routing>
      <server
#foreach ($line in $lines)
#set ($i = $velocityCount)
#set ($group = $line.getSetting('line-dialplan').getSetting('digitmap').getSetting("routing.1"))
        dialplan.${i}.routing.server.1.address="$!{group.getSetting('address').Value}"
        dialplan.${i}.routing.server.1.port="$!{group.getSetting('port').Value}"
#end
      />
      <emergency
#foreach ($line in $lines)
#set ($i = $velocityCount)
#foreach ($emergencyVal in $cfg.getLineEmergencySetting($line))
#set ($j = $velocityCount)
        dialplan.${i}.routing.emergency.${j}.value="$!{emergencyVal}"
        dialplan.${i}.routing.emergency.${j}.server.1="1"
#end
#end
      />
    </routing>
  </dialplan>
<device device.set="1"
#set ($group = $cfg.EndpointSettings.getSetting('log').getSetting('device.syslog'))
#foreach ($setting in $cfg.getSettings($group))
    device.syslog.${setting.ProfileName}="$!{setting.Value}"
#end

#set ($group = $cfg.EndpointSettings.getSetting('network').getSetting('device.net'))
#if ($cfg.EndpointSettings.getSetting('network').getSetting('device.net').getSetting('overwrite').Value != 0)
#foreach ($setting in $cfg.getSettings($group))
#if (${setting.ProfileName} != '$ignore$')
    device.net.${setting.ProfileName}="$!{setting.Value}"
#end
#end 
#end
/>
</polycomConfig>