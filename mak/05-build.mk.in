help.reconf=Re-run original configure script with same arguments as before.
reconf :
	$(SRC)/configure @CONFIGURE_OPTIONS@

help.sipx.autoreconf=Run autoreconf on each project
$(foreach T,$(sipx),$(T).autoreconf) : 
	@echo $@
	cd $(SRC)/$(PROJDIR); \
	  autoreconf -if

help.sipx=Build all sipx components including autoreconf, configure, all and install targets
build sipx :
	$(MAKE) $(foreach P,$(sipx),$(P))

$(foreach T,$(sipx),$(T)) : % : %.autoreconf %.configure %.all-install ;

help.sipx.all-install=Run "make all install" in each target
$(foreach T,$(sipx),$(T).all-install) : %.all-install : %.all %.install ;

help.configure = Run configure on each project
$(foreach T,$(sipx),$(T).configure) : 
	test -d $(PROJDIR) || mkdir $(PROJDIR)
	cd $(PROJDIR); \
	  $(SRC)/$(PROJDIR)/configure --disable-option-checking @CONFIGURE_OPTIONS@

MAKE_COMMANDS = check install clean dist uninstall-rpm
$(foreach C,$(MAKE_COMMANDS) all,$(eval help.sipx.$(C)=Run make $(C) on each project))

$(foreach C,$(MAKE_COMMANDS),$(foreach T,$(sipx),$(T).$(C))) :
	$(MAKE) -C $(PROJDIR) $(patsubst $(PROJ).%,%,$@)

help.sipx.rpm = Make rpm on each project, this will also install the RPM w/o executing RPM install scripts. Call make uninstall-rpm to remove after a successful build.  Eventually this should use the mock utility for building rpms in an isolated way.
$(foreach T,$(sipx),$(T).rpm) :
	$(MAKE) -C $(PROJDIR) rpm install-rpm

# shortcuts, support "make clean" and a shortcut for "make sipx.clean"
$(foreach C,$(MAKE_COMMANDS) all rpm,$(eval $(C) : sipx.$(C);))

# projects do not all have an "all" target, they probably should, until then, use
# no-target default
$(foreach C,all,$(foreach T,$(sipx),$(T).all)) :
	$(MAKE) -C $(PROJDIR)

help.sipx.update-version = Update all sipx components to the current version.
$(foreach T,$(sipx),$(T).update-version) :
	sed -i -e 's/\(AC_INIT(.*, \)[0-9.]\+\(.*\)/\1@PACKAGE_VERSION@\2/g' $(SRC)/$(PROJDIR)/configure.ac

# don't list other sipx projects
BUILD_DEPS_ = \
	$(foreach P,$(sipx),-e '/$(P)/d') \
	-e 's/java-1_6_0-sun-devel/java-devel/'

BUILD_DEPS_CentOS_5 = \
	$(LOCALIZE) \
	-e '/docbook-xsl-stylesheets/d'

$(foreach T,10 11 12 13 14 15 16 17 18 19 20,$(eval BUILD_DEPS_Fedora_$(T) = $(CentOS_5)))

sipx.list-deps sipx.list-missing-deps : sipx.% :
	@$(MAKE) --no-print-directory $(foreach T,$(sipx),$(strip $(T)).$*) | sort -u

help.sipx.list-deps = List all dependencies to build package(s) that are not currently installed on this system.
$(foreach T,$(sipx),$(T).list-missing-deps) :
	@rpm -q rpm `$(MAKE) --no-print-directory $(PROJ).list-deps` | grep 'is not installed' | awk '{print $$2}'

help.sipx.list-deps = List all dependencies to build package(s).
$(foreach T,$(sipx),$(T).list-deps) :
	@grep BuildRequires: $(PROJDIR)/$(PROJ).spec.in | awk '{print $$2}' | sed $(LOCALIZE_$(TARGET_PLATFORM)) | sort -u

repofile :
	@echo "$$repofile_contents"

define repofile_contents
[sipXecs]
name=sipXecs software for $(TARGET_DISTRO) $$releasever - $$basearch
baseurl=http://download.sipfoundry.org/pub/sipXecs/@PACKAGE_VERSION@/$(TARGET_DISTRO)_$$releasever/$$basearch
gpgcheck=0
endef
export repofile_contents
