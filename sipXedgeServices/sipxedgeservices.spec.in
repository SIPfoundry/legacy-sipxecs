Name: @PACKAGE@
Version: @VERSION@
Release: @PACKAGE_REVISION@

Summary: SIP Bridging Solutions for sipXecs
License: AGPL
Vendor: Ezuce Inc.
Url: http://www.ezuce.com


BuildRequires: automake
BuildRequires: gcc-c++
BuildRequires: cppunit-devel
BuildRequires: zip

%if 0%{?fedora} >= 18
BuildRequires: libdb4-cxx-devel
BuildRequires: libdb4-devel
Requires: libdb4-cxx
Requires: libdb4
%endif

%if 0%{?fedora_version} < 18 || 0%{?rhel} >= 6
BuildRequires: db4-devel
Requires: db4
%endif


BuildRequires: sipxcommserverlib-devel  >= %version
BuildRequires: sipxportlib-devel        >= %version
BuildRequires: sipxtacklib-devel        >= %version
BuildRequires: sipxresiprocate-devel    >= %version
BuildRequires: sipxesllib-devel >= %version
BuildRequires: libjsonrpccpp-devel
BuildRequires: cmake
BuildRequires: libevent2-devel
BuildRequires: python >= 2.3
BuildRequires: python-devel >= 2.3
BuildRequires: c-ares-devel
BuildRequires: java-1.7.0-openjdk-devel
BuildRequires: sipxcommons >= %version
BuildRequires: sipxconfig >= %version

Requires: sipxesllib
Requires: sipxcommserverlib  >= %version
Requires: sipxportlib        >= %version
Requires: sipxtacklib       >= %version
Requires: sipxresiprocate-libs    >= %version
Requires: sipxesllib >= %version
Requires: libjsonrpccpp
Requires: sipxedgeservices-config
Requires: sipxyard
Requires: monit
Requires: freeswitch
Requires: freeswitch-lang-en
Requires: python >= 2.3
Requires: c-ares
Requires: chkconfig
Requires: sipxcommons >= %version

Source:   %name-%version.tar.gz

%description
SIP Bridging Solutions for sipXecs

%package utils
Requires: %name
Summary: Utility Applications for sipX Edge Services

%description utils
Utility Applications for sipX Edge Services

%package rpc
Requires: %name
Summary: RPC Server for sipX Edge Services

%description rpc
RPC Server for sipX Edge Services

%package config
Requires: %name
Summary: Configuration files for sipX Edge Services

%description config
Configuration files for sipX Edge Services

%prep
%setup -q

%build
%configure @SIPX_RPM_CONFIGURE_OPTIONS@
cp config.log %name.configlog
make %{_smp_mflags}

%install
make DESTDIR=%{buildroot} install
rm -rf %{buildroot}/include/esl
rm -rf %{buildroot}/usr/opt/sipxpbx/edge/include
#
# Install configuration templates
#
mkdir -p %{buildroot}/etc/sipxpbx/edge
chmod 755 %{buildroot}/etc/sipxpbx/edge
cp -rpP applications/config %{buildroot}/%{_sysconfdir}/sipxpbx/edge/.config


%clean
rm -rf $RPM_BUILD_ROOT

%files
%defattr(644,root,root,755)
%attr(755,root,root) %{_bindir}/sipxwebrtc

%files utils
%defattr(644,root,root,755)
%attr(755,root,root) %{_bindir}/sipxcallgen_fs

%files rpc
%defattr(644,root,root,755)
%attr(755,root,root) %{_bindir}/sipxedgerpc
%attr(755,root,root) %{_sysconfdir}/init.d/sipxedgerpc
%{_datadir}/sipxecs/cfinputs/plugin.d/sipxedgerpc.cf
%{_sysconfdir}/sipxpbx/sipxedgerpc/sipxedgerpc.properties
%{_sysconfdir}/sipxpbx/sipxedgerpc/sipxedgerpc.xml
%{_datadir}/java/sipXecs/sipXconfig/plugins/sipxedgerpc-config-plugin.jar

%files config
%dir %attr(0750,-,-) %{_sysconfdir}/sipxpbx/edge/.config
%{_sysconfdir}/sipxpbx/edge/.config/*


